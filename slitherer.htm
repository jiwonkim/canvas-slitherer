<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="style.css">
<script type="text/javascript" src="tools/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="slitherer.js"></script>
</head>
<body>
<script type="text/javascript">
$(function() {
    document.onselectstart = function () { return false; }
    var field = slitherer()
        .init(
            document.getElementById('board-layer'),
            document.getElementById('snakes-layer'),
            document.getElementById('ladders-layer'),
            document.getElementById('cursor-layer')
        );

    var mousedown = false;
    var modeOffset = 5;
    $('canvas').mousedown(function(evt) {
        mousedown = true;
        if(field.mode()=='snakes') {
            field.addSnake(evt.offsetX + modeOffset, evt.offsetY + modeOffset); 
        }
    }).mouseup(function(evt) {
        mousedown = false;
        if(field.mode()=='snakes') {
            field.endSnake(evt.offsetX + modeOffset, evt.offsetY + modeOffset); 
        }
    }).mouseout(function(evt) {
        // remove mouse cursor image
        field.clearLayer('cursor')
    }).mousemove(function(evt) {
        // display mode as mouse cursor
        field.displayCursor(evt.offsetX, evt.offsetY);
        
        if(!mousedown) return;
        try {
            switch(field.mode()) {
                case 'roads':
                    field.addRoadAt(evt.offsetX + modeOffset, evt.offsetY + modeOffset);
                    break;
                case 'snakes':
                    field.updateSnake(evt.offsetX + modeOffset, evt.offsetY + modeOffset);
                    break;
                case 'ladders':
                    console.log("Add ladder");
                    break;
                default:
                    break;
            }
        } catch (err) {
            mousedown=false;
            $('#errors p').html(err);
        }
    });

    $('#mode-selector button').click(function() {
        $('#mode-selector .selected').removeClass('selected');
        $(this).addClass('selected');
        field.mode($(this).attr('id'));
    }); 
    $('#tool-selector button').click(function() {
        var id = $(this).attr('id');
        if(id!='start-over') {
            $('#tool-selector .selected').removeClass('selected');
            $(this).addClass('selected');
            field.tool(id);
        } else {
            field.clearLayer(field.mode());
        }
    }); 
});
</script>
<div id="top">
<img src="images/title.jpg" />
<hr />
</div>
<div id="left">
    <div id="mode-selector">
        <button class="selected" id="roads"></button>
        <button id="snakes"></button>
        <button id="ladders"></button>
    </div>

    <hr />
    
    <div id="tool-selector">
        <button id="add" class="selected"></button>
        <button id="delete"></button>
        <button id="start-over"></button>
    </div>

</div>
<div id="right">
    <div id="status">
    <img src="images/erroricon.png" />
    <p>Errors here</p>
    </div>
    <div id="viewport">
        <canvas id="board-layer" width="900" height="540"></canvas>
        <canvas id="snakes-layer" width="900" height="540"></canvas>
        <canvas id="ladders-layer" width="900" height="540"></canvas>
        <canvas id="cursor-layer" width="900" height="540"></canvas>
    </div>
</div>
</body>
</html>
