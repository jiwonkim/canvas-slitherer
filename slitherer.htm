<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="style.css">
<script type="text/javascript" src="tools/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="slitherer.js"></script>
</head>
<body>
<script type="text/javascript">
function displayStatus(statusName, message) {
    ['idea', 'ok', 'warning', 'error'].forEach(function(s) {
        if(s==statusName) {
            $('.status-'+s).css('display', 'block');
        } else {
            $('.status-'+s).css('display', 'none');
        }
    });
    $('p.status-'+statusName).html(message);
}
$(function() {
    document.onselectstart = function () { return false; }
    var field = slitherer()
        .init(
            document.getElementById('board-layer'),
            document.getElementById('snakes-layer'),
            document.getElementById('ladders-layer'),
            document.getElementById('cursor-layer')
        );

    var mousedown = false;
    var modeOffset = 5;
    $('canvas').mousedown(function(evt) {
        mousedown = true;
        try {
            if(field.mode()=='snakes') {
                field.addSnake(evt.offsetX + modeOffset, evt.offsetY + modeOffset); 
            } else if(field.mode()=='ladders') {
                field.addLadder(evt.offsetX + modeOffset, evt.offsetY + modeOffset); 
            }
        } catch(err) {
            displayStatus(err.type, err.message); 
        }

    }).mouseup(function(evt) {
        mousedown = false;
        try {
            if(field.mode()=='snakes') {
                field.endSnake(evt.offsetX + modeOffset, evt.offsetY + modeOffset); 
                displayStatus('idea', 'Add a snake by dragging the mouse from road to road.');
            } else if(field.mode()=='ladders') {
                field.endLadder(evt.offsetX + modeOffset, evt.offsetY + modeOffset); 
                displayStatus('idea', 'Add a ladder by dragging the mouse from road to road.');
            } else if(field.mode()=='roads') {
                if(field.endRoad()) {
                    displayStatus('ok', 'Congratulations! You have successfully built a road.');
                }
            }
        } catch(err) {
            displayStatus(err.type, err.message);  
        }
    }).mouseout(function(evt) {
        // remove mouse cursor image
        field.clearLayer('cursor')
    }).mousemove(function(evt) {
        // display mode as mouse cursor
        field.displayCursor(evt.offsetX, evt.offsetY);
        
        if(!mousedown) return;
        try {
            switch(field.mode()) {
                case 'roads':
                    field.addRoadAt(evt.offsetX + modeOffset, evt.offsetY + modeOffset);
                    displayStatus('idea', 'Build a road by dragging the mouse on the board.');
                    break;
                case 'snakes':
                    field.updateSnake(
                        evt.offsetX + modeOffset,
                        evt.offsetY + modeOffset,
                        true
                    );
                    displayStatus('idea', 'Add a snake by dragging the mouse from road to road.');
                    break;
                case 'ladders':
                    field.updateLadder(
                        evt.offsetX + modeOffset,
                        evt.offsetY + modeOffset,
                        true
                    );
                    displayStatus('idea', 'Add a ladder by dragging the mouse from road to road.');
                    break;
                default:
                    break;
            }
        } catch (err) {
            mousedown=false;
            displayStatus(err.type, err.message);
        }
    });

    $('#mode-selector button').click(function() {
        $('#mode-selector .selected').removeClass('selected');
        $(this).addClass('selected');
        var mode = $(this).attr('id');
        field.mode(mode);
        switch(mode) {
            case 'roads':
                displayStatus('idea', 'Build a road by dragging the mouse on the board.');
                break;
            case 'snakes':
                displayStatus('idea', 'Add a snake by dragging the mouse from road to road.');
                break;
            case 'ladders':
                displayStatus('idea', 'Add a ladder by dragging the mouse from road to road.');
                break;
            default:
                break;
        }
    }); 
    $('#tool-selector button').click(function() {
        var id = $(this).attr('id');
        if(id!='start-over') {
            $('#tool-selector .selected').removeClass('selected');
            $(this).addClass('selected');
            field.tool(id);
        } else {
            field.clearLayer(field.mode());
        }
    }); 
});
</script>
<div id="top">
    <img id="title" src="images/title-small.png" />
    <div id="status">
        <img class="status-ok" src="images/checkicon.png" />
        <img class="status-warning" src="images/bangicon.png" />
        <img class="status-error" src="images/erroricon.png" />
        <img class="status-idea" src="images/ideaicon.png" />
        <p class="status-ok"></p>
        <p class="status-warning"></p>
        <p class="status-error"></p>
        <p class="status-idea">Build a road by dragging the mouse on the board.</p>
    </div>
    <div id="mode-selector">
        <button class="selected" id="roads"></button>
        <button id="snakes"></button>
        <button id="ladders"></button>
    </div>
    
    <div id="tool-selector">
        <!--button id="add" class="selected"></button-->
        <button id="start-over"></button>
    </div>
</div>
<div id="left">
    <div class="center" id="action-selector">
        <button id="build" class="selected">Build</button>
        <button id="play">Play</button>
    </div>

    <div id="controls" class="center">
    </div>

</div>
<div id="right">
    <div id="viewport">
        <canvas id="board-layer" width="900" height="540"></canvas>
        <canvas id="snakes-layer" width="900" height="540"></canvas>
        <canvas id="ladders-layer" width="900" height="540"></canvas>
        <canvas id="cursor-layer" width="900" height="540"></canvas>
    </div>
</div>
</body>
</html>
